import React, { useMemo, useState } from "react";
import { motion } from "framer-motion";
import { CalendarDays, MapPinned, Users, Gift, Copy, Share2, Clock, Shield } from "lucide-react";

const mapLinks = (name: string, address: string) => ({
  naver: `https://map.naver.com/v5/search/${encodeURIComponent(name + ' ' + address)}`,
  kakao: `https://map.kakao.com/link/search/${encodeURIComponent(name + ' ' + address)}`,
});

const attendees = [
  { name: "👩🏻 윤명순", role: "회장" },
  { name: "👩🏻 표정희" },
  { name: "👩🏻 유인숙" },
  { name: "👩🏻 이명경" },
  { name: "👩🏻 박진숙" },
  { name: "👩🏻 정윤호" },
];

const spots = [
  { section: "1차", name: "노리타", address: "서울 강남구 강남대로 428 3층 2-301호" },
  { section: "2차", name: "오늘통닭", address: "서울특별시 서초구 서초동 1327-33 비트빌빌딩 1층" },
  { section: "2차", name: "강탄", address: "서울 강남구 테헤란로1길 28-4 JWHouse 2층 강탄 강남역점" },
  { section: "2차", name: "교촌치킨 강남", address: "서울특별시 강남구 역삼동 619-28 1층" },
  { section: "카페", name: "투썸플레이스 강남역중앙점", address: "서울 강남구 테헤란로1길 16 삼원빌딩" },
];

const Snow = () => {
  const flakes = useMemo(() => Array.from({ length: 25 }).map((_, i) => ({
    id: i,
    left: Math.random() * 100,
    size: Math.random() * 5 + 5,
    delay: Math.random() * 8,
    duration: Math.random() * 6 + 7,
    opacity: Math.random() * 0.4 + 0.35,
  })), []);
  return (
    <div className="pointer-events-none absolute inset-0 overflow-hidden">
      {flakes.map(f => (
        <motion.div
          key={f.id}
          initial={{ y: -60, opacity: 0 }}
          animate={{ y: [ -60, 900 ], opacity: [0, f.opacity, 0] }}
          transition={{ repeat: Infinity, delay: f.delay, duration: f.duration, ease: "linear" }}
          className="absolute"
          style={{ left: `${f.left}%` }}
        >
          <div style={{ fontSize: f.size }} className="select-none">❄️</div>
        </motion.div>
      ))}
    </div>
  );
};

const Card: React.FC<{ children: React.ReactNode; className?: string }> = ({ children, className }) => (
  <div className={`rounded-2xl bg-white/90 backdrop-blur shadow-lg border border-white/40 ${className || ""}`}>{children}</div>
);

export default function App() {
  const [rsvps, setRsvps] = useState(() =>
    Object.fromEntries(attendees.map(a => [a.name, "참석"])) as Record<string, "참석" | "미정" | "불참">
  );

  const copyLink = async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      alert("링크가 복사되었습니다. 카카오톡에 붙여넣어 공유해주세요!");
    } catch {
      alert("주소창의 링크를 직접 복사해 주세요.");
    }
  };

  const share = async () => {
    const title = "시형회 연말모임";
    const text = "시경 형사과 동기 모임 안내";
    const url = window.location.href;
    if ((navigator as any).share) {
      try { await (navigator as any).share({ title, text, url }); } catch {}
    } else {
      copyLink();
    }
  };

  const schedule = [
    { time: "17:00", title: "1차 시작", emoji: "👮‍♀️", place: "노리타" },
    { time: "19:00", title: "2차 (자율)", emoji: "🍗", place: "오늘통닭 外" },
    { time: "21:00", title: "카페 (자율)", emoji: "☕", place: "투썸" },
  ];

  return (
    <div className="min-h-[100dvh] bg-gradient-to-b from-[#f1f7ff] to-[#cfe5ff] text-neutral-800">
      <div className="relative mx-auto max-w-md px-5 pb-20 space-y-7">
        <Snow />

        {/* Header */}
        <header className="pt-10 pb-6 text-center space-y-3">
          <div className="inline-flex items-center gap-2 rounded-full bg-blue-100 px-3 py-1 text-xs text-blue-800">
            <Shield className="w-4 h-4" /> 시형회 · 연말모임
          </div>
          <h1 className="text-2xl font-bold text-blue-900 tracking-wide leading-relaxed">
            👮‍♀️ 오래된 우정, 다시 피어나는 시간
          </h1>
          <p className="text-[14px] text-blue-800/80 leading-relaxed tracking-wide">
            시경 형사과의 인연, 다시 하나로 모입니다.<br/>
            마음을 나누고 웃음이 피어나는 따뜻한 밤이 되길 바랍니다.
          </p>
          <div className="mt-4 flex justify-center gap-2">
            <button onClick={share} className="rounded-full bg-blue-500 px-4 py-2 text-sm font-semibold text-white shadow-lg active:scale-95 flex items-center gap-1">
              <Share2 className="w-4 h-4" /> 공유하기
            </button>
            <button onClick={copyLink} className="rounded-full bg-white px-4 py-2 text-sm font-semibold text-blue-800 shadow-lg active:scale-95 flex items-center gap-1">
              <Copy className="w-4 h-4" /> 링크복사
            </button>
          </div>
        </header>

        {/* 일정 */}
        <Card className="p-5 space-y-2">
          <div className="flex items-start gap-2">
            <Clock className="w-5 h-5 text-blue-700 mt-0.5" />
            <div className="text-sm leading-relaxed tracking-wide">
              <p><b>🕔 17시</b> 1차에서 시작합니다.</p>
              <p>2차, 카페는 자율 참여로 이동할 예정입니다.</p>
            </div>
          </div>
        </Card>

        {/* 일정표 */}
        <Card className="p-5 space-y-3">
          <h2 className="text-blue-900 font-semibold mb-2 tracking-wide text-lg">📅 일정</h2>
          <ul className="space-y-2">
            {schedule.map((s, i) => (
              <li key={i} className="flex justify-between items-center rounded-xl bg-white/80 hover:bg-blue-50 transition px-3 py-2 shadow-sm">
                <div className="text-sm leading-relaxed">
                  <b>{s.emoji} {s.title}</b>
                  <div className="text-xs text-neutral-600 mt-1">{s.place}</div>
                </div>
                <div className="text-xs text-blue-800 font-semibold">{s.time}</div>
              </li>
            ))}
          </ul>
        </Card>

        {/* 참석자 */}
        <Card className="p-5 space-y-3">
          <h2 className="text-blue-900 font-semibold mb-2 tracking-wide text-lg">👥 참석자</h2>
          <ul className="grid grid-cols-2 gap-3 text-sm">
            {attendees.map(a => (
              <li key={a.name}>
                <button
                  onClick={() => setRsvps(prev => ({ ...prev, [a.name]: prev[a.name] === "참석" ? "미정" : prev[a.name] === "미정" ? "불참" : "참석" }))}
                  className={`w-full rounded-xl px-3 py-3 border text-left leading-relaxed tracking-wide flex flex-col justify-center shadow-sm transition ${
                    rsvps[a.name] === "참석" ? "bg-blue-100 border-blue-200" : rsvps[a.name] === "미정" ? "bg-yellow-100 border-yellow-200" : "bg-neutral-100 border-neutral-200"
                  }`}
                >
                  <div className="font-medium text-[15px]">{a.name} {a.role && <span className="text-xs text-blue-800">({a.role})</span>}</div>
                  <div className="text-xs text-neutral-600 mt-0.5">상태: {rsvps[a.name]}</div>
                </button>
              </li>
            ))}
          </ul>
        </Card>

        {/* 장소 */}
        <Card className="p-5">
          <h2 className="text-blue-900 font-semibold mb-3 tracking-wide text-lg">🗺️ 장소 안내</h2>
          <div className="overflow-hidden rounded-xl border border-neutral-200 text-sm">
            <table className="w-full">
              <thead className="bg-blue-50">
                <tr>
                  <th className="px-3 py-2 text-left">구분</th>
                  <th className="px-3 py-2 text-left">이름</th>
                  <th className="px-3 py-2 text-left">길찾기</th>
                </tr>
              </thead>
              <tbody>
                {spots.map((s, idx) => {
                  const links = mapLinks(s.name, s.address);
                  return (
                    <tr key={idx} className="odd:bg-white even:bg-blue-50/60">
                      <td className="px-3 py-3 align-top">{s.section}</td>
                      <td className="px-3 py-3 align-top font-medium">{s.name}</td>
                      <td className="px-3 py-3 whitespace-nowrap align-top space-x-2">
                        <a href={links.naver} target="_blank" rel="noreferrer" className="inline-block rounded-full bg-blue-100 text-blue-800 px-3 py-1 hover:bg-blue-200 transition text-xs font-medium shadow-sm">네이버</a>
                        <a href={links.kakao} target="_blank" rel="noreferrer" className="inline-block rounded-full bg-yellow-100 text-yellow-800 px-3 py-1 hover:bg-yellow-200 transition text-xs font-medium shadow-sm">카카오</a>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </Card>

        <footer className="mt-8 pb-10 text-center text-[11px] text-blue-800/70 tracking-wide leading-relaxed">
          © 2025 Sihyung-hoe · 함께여서 더 따뜻한 시간
        </footer>
      </div>
    </div>
  );
}
