import React, { useMemo, useState } from "react";
import { motion } from "framer-motion";
import { CalendarDays, MapPinned, Users, Gift, Copy, Share2, Clock, Shield } from "lucide-react";

const mapLinks = (name: string, address: string) => ({
  naver: `https://map.naver.com/v5/search/${encodeURIComponent(name + ' ' + address)}`,
  kakao: `https://map.kakao.com/link/search/${encodeURIComponent(name + ' ' + address)}`,
});

const attendees = [
  { name: "ğŸ‘©ğŸ» ìœ¤ëª…ìˆœ", role: "íšŒì¥" },
  { name: "ğŸ‘©ğŸ» í‘œì •í¬" },
  { name: "ğŸ‘©ğŸ» ìœ ì¸ìˆ™" },
  { name: "ğŸ‘©ğŸ» ì´ëª…ê²½" },
  { name: "ğŸ‘©ğŸ» ë°•ì§„ìˆ™" },
  { name: "ğŸ‘©ğŸ» ì •ìœ¤í˜¸" },
];

const spots = [
  { section: "1ì°¨", name: "ë…¸ë¦¬íƒ€", address: "ì„œìš¸ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ 428 3ì¸µ 2-301í˜¸" },
  { section: "2ì°¨", name: "ì˜¤ëŠ˜í†µë‹­", address: "ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ ì„œì´ˆë™ 1327-33 ë¹„íŠ¸ë¹Œë¹Œë”© 1ì¸µ" },
  { section: "2ì°¨", name: "ê°•íƒ„", address: "ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ1ê¸¸ 28-4 JWHouse 2ì¸µ ê°•íƒ„ ê°•ë‚¨ì—­ì " },
  { section: "2ì°¨", name: "êµì´Œì¹˜í‚¨ ê°•ë‚¨", address: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 619-28 1ì¸µ" },
  { section: "ì¹´í˜", name: "íˆ¬ì¸í”Œë ˆì´ìŠ¤ ê°•ë‚¨ì—­ì¤‘ì•™ì ", address: "ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ1ê¸¸ 16 ì‚¼ì›ë¹Œë”©" },
];

const Snow = () => {
  const flakes = useMemo(() => Array.from({ length: 25 }).map((_, i) => ({
    id: i,
    left: Math.random() * 100,
    size: Math.random() * 5 + 5,
    delay: Math.random() * 8,
    duration: Math.random() * 6 + 7,
    opacity: Math.random() * 0.4 + 0.35,
  })), []);
  return (
    <div className="pointer-events-none absolute inset-0 overflow-hidden">
      {flakes.map(f => (
        <motion.div
          key={f.id}
          initial={{ y: -60, opacity: 0 }}
          animate={{ y: [ -60, 900 ], opacity: [0, f.opacity, 0] }}
          transition={{ repeat: Infinity, delay: f.delay, duration: f.duration, ease: "linear" }}
          className="absolute"
          style={{ left: `${f.left}%` }}
        >
          <div style={{ fontSize: f.size }} className="select-none">â„ï¸</div>
        </motion.div>
      ))}
    </div>
  );
};

const Card: React.FC<{ children: React.ReactNode; className?: string }> = ({ children, className }) => (
  <div className={`rounded-2xl bg-white/90 backdrop-blur shadow-lg border border-white/40 ${className || ""}`}>{children}</div>
);

export default function App() {
  const [rsvps, setRsvps] = useState(() =>
    Object.fromEntries(attendees.map(a => [a.name, "ì°¸ì„"])) as Record<string, "ì°¸ì„" | "ë¯¸ì •" | "ë¶ˆì°¸">
  );

  const copyLink = async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ì–´ ê³µìœ í•´ì£¼ì„¸ìš”!");
    } catch {
      alert("ì£¼ì†Œì°½ì˜ ë§í¬ë¥¼ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
    }
  };

  const share = async () => {
    const title = "ì‹œí˜•íšŒ ì—°ë§ëª¨ì„";
    const text = "ì‹œê²½ í˜•ì‚¬ê³¼ ë™ê¸° ëª¨ì„ ì•ˆë‚´";
    const url = window.location.href;
    if ((navigator as any).share) {
      try { await (navigator as any).share({ title, text, url }); } catch {}
    } else {
      copyLink();
    }
  };

  const schedule = [
    { time: "17:00", title: "1ì°¨ ì‹œì‘", emoji: "ğŸ‘®â€â™€ï¸", place: "ë…¸ë¦¬íƒ€" },
    { time: "19:00", title: "2ì°¨ (ììœ¨)", emoji: "ğŸ—", place: "ì˜¤ëŠ˜í†µë‹­ å¤–" },
    { time: "21:00", title: "ì¹´í˜ (ììœ¨)", emoji: "â˜•", place: "íˆ¬ì¸" },
  ];

  return (
    <div className="min-h-[100dvh] bg-gradient-to-b from-[#f1f7ff] to-[#cfe5ff] text-neutral-800">
      <div className="relative mx-auto max-w-md px-5 pb-20 space-y-7">
        <Snow />

        {/* Header */}
        <header className="pt-10 pb-6 text-center space-y-3">
          <div className="inline-flex items-center gap-2 rounded-full bg-blue-100 px-3 py-1 text-xs text-blue-800">
            <Shield className="w-4 h-4" /> ì‹œí˜•íšŒ Â· ì—°ë§ëª¨ì„
          </div>
          <h1 className="text-2xl font-bold text-blue-900 tracking-wide leading-relaxed">
            ğŸ‘®â€â™€ï¸ ì˜¤ë˜ëœ ìš°ì •, ë‹¤ì‹œ í”¼ì–´ë‚˜ëŠ” ì‹œê°„
          </h1>
          <p className="text-[14px] text-blue-800/80 leading-relaxed tracking-wide">
            ì‹œê²½ í˜•ì‚¬ê³¼ì˜ ì¸ì—°, ë‹¤ì‹œ í•˜ë‚˜ë¡œ ëª¨ì…ë‹ˆë‹¤.<br/>
            ë§ˆìŒì„ ë‚˜ëˆ„ê³  ì›ƒìŒì´ í”¼ì–´ë‚˜ëŠ” ë”°ëœ»í•œ ë°¤ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤.
          </p>
          <div className="mt-4 flex justify-center gap-2">
            <button onClick={share} className="rounded-full bg-blue-500 px-4 py-2 text-sm font-semibold text-white shadow-lg active:scale-95 flex items-center gap-1">
              <Share2 className="w-4 h-4" /> ê³µìœ í•˜ê¸°
            </button>
            <button onClick={copyLink} className="rounded-full bg-white px-4 py-2 text-sm font-semibold text-blue-800 shadow-lg active:scale-95 flex items-center gap-1">
              <Copy className="w-4 h-4" /> ë§í¬ë³µì‚¬
            </button>
          </div>
        </header>

        {/* ì¼ì • */}
        <Card className="p-5 space-y-2">
          <div className="flex items-start gap-2">
            <Clock className="w-5 h-5 text-blue-700 mt-0.5" />
            <div className="text-sm leading-relaxed tracking-wide">
              <p><b>ğŸ•” 17ì‹œ</b> 1ì°¨ì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.</p>
              <p>2ì°¨, ì¹´í˜ëŠ” ììœ¨ ì°¸ì—¬ë¡œ ì´ë™í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
          </div>
        </Card>

        {/* ì¼ì •í‘œ */}
        <Card className="p-5 space-y-3">
          <h2 className="text-blue-900 font-semibold mb-2 tracking-wide text-lg">ğŸ“… ì¼ì •</h2>
          <ul className="space-y-2">
            {schedule.map((s, i) => (
              <li key={i} className="flex justify-between items-center rounded-xl bg-white/80 hover:bg-blue-50 transition px-3 py-2 shadow-sm">
                <div className="text-sm leading-relaxed">
                  <b>{s.emoji} {s.title}</b>
                  <div className="text-xs text-neutral-600 mt-1">{s.place}</div>
                </div>
                <div className="text-xs text-blue-800 font-semibold">{s.time}</div>
              </li>
            ))}
          </ul>
        </Card>

        {/* ì°¸ì„ì */}
        <Card className="p-5 space-y-3">
          <h2 className="text-blue-900 font-semibold mb-2 tracking-wide text-lg">ğŸ‘¥ ì°¸ì„ì</h2>
          <ul className="grid grid-cols-2 gap-3 text-sm">
            {attendees.map(a => (
              <li key={a.name}>
                <button
                  onClick={() => setRsvps(prev => ({ ...prev, [a.name]: prev[a.name] === "ì°¸ì„" ? "ë¯¸ì •" : prev[a.name] === "ë¯¸ì •" ? "ë¶ˆì°¸" : "ì°¸ì„" }))}
                  className={`w-full rounded-xl px-3 py-3 border text-left leading-relaxed tracking-wide flex flex-col justify-center shadow-sm transition ${
                    rsvps[a.name] === "ì°¸ì„" ? "bg-blue-100 border-blue-200" : rsvps[a.name] === "ë¯¸ì •" ? "bg-yellow-100 border-yellow-200" : "bg-neutral-100 border-neutral-200"
                  }`}
                >
                  <div className="font-medium text-[15px]">{a.name} {a.role && <span className="text-xs text-blue-800">({a.role})</span>}</div>
                  <div className="text-xs text-neutral-600 mt-0.5">ìƒíƒœ: {rsvps[a.name]}</div>
                </button>
              </li>
            ))}
          </ul>
        </Card>

        {/* ì¥ì†Œ */}
        <Card className="p-5">
          <h2 className="text-blue-900 font-semibold mb-3 tracking-wide text-lg">ğŸ—ºï¸ ì¥ì†Œ ì•ˆë‚´</h2>
          <div className="overflow-hidden rounded-xl border border-neutral-200 text-sm">
            <table className="w-full">
              <thead className="bg-blue-50">
                <tr>
                  <th className="px-3 py-2 text-left">êµ¬ë¶„</th>
                  <th className="px-3 py-2 text-left">ì´ë¦„</th>
                  <th className="px-3 py-2 text-left">ê¸¸ì°¾ê¸°</th>
                </tr>
              </thead>
              <tbody>
                {spots.map((s, idx) => {
                  const links = mapLinks(s.name, s.address);
                  return (
                    <tr key={idx} className="odd:bg-white even:bg-blue-50/60">
                      <td className="px-3 py-3 align-top">{s.section}</td>
                      <td className="px-3 py-3 align-top font-medium">{s.name}</td>
                      <td className="px-3 py-3 whitespace-nowrap align-top space-x-2">
                        <a href={links.naver} target="_blank" rel="noreferrer" className="inline-block rounded-full bg-blue-100 text-blue-800 px-3 py-1 hover:bg-blue-200 transition text-xs font-medium shadow-sm">ë„¤ì´ë²„</a>
                        <a href={links.kakao} target="_blank" rel="noreferrer" className="inline-block rounded-full bg-yellow-100 text-yellow-800 px-3 py-1 hover:bg-yellow-200 transition text-xs font-medium shadow-sm">ì¹´ì¹´ì˜¤</a>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </Card>

        <footer className="mt-8 pb-10 text-center text-[11px] text-blue-800/70 tracking-wide leading-relaxed">
          Â© 2025 Sihyung-hoe Â· í•¨ê»˜ì—¬ì„œ ë” ë”°ëœ»í•œ ì‹œê°„
        </footer>
      </div>
    </div>
  );
}
